### Отчет по лабораторной работе №4: Обработка и валидация форм

#### Инструкции по запуску проекта
1. Установите PHP (если не установлен).
2. Скачайте файлы проекта.
3. Откройте проект в Visual Studio Code или другой IDE.
4. Перейдите в директорию `public` через терминал с помощью команды:  
   ```
   cd public
   ```
5. Запустите локальный сервер командой:  
   ```
   php -S localhost:8080
   ```
6. Откройте браузер и перейдите по адресу:  
   ```
   http://localhost:8080
   ```

#### Описание лабораторной работы
**Цель работы** – освоить основные принципы работы с HTML-формами в PHP, включая отправку данных на сервер, их фильтрацию, валидацию и сохранение. В рамках работы реализован проект "Система управления задачами", который позволяет добавлять задачи с различными параметрами, отображать последние задачи на главной странице и просматривать полный список задач.

Проект стал основой для дальнейшего изучения разработки веб-приложений и может быть расширен в последующих лабораторных работах.

#### Краткая документация к проекту
- **Файл `public/index.php`** – главная страница, отображающая две последние задачи из файла `storage/tasks.txt`.
- **Файл `public/task/create.php`** – форма добавления задачи с полями для ввода данных и отображением ошибок валидации.
- **Файл `public/task/index.php`** – страница со списком всех задач.
- **Файл `src/handlers/handle_task.php`** – обработчик формы, выполняющий фильтрацию, валидацию и сохранение данных.
- **Файл `src/helpers.php`** – вспомогательные функции для работы с данными формы.
- **Файл `storage/tasks.txt`** – текстовый файл для хранения задач в формате JSON.

#### Фрагменты кода, описание выполнения заданий

##### `public/task/create.php`
Файл содержит HTML-форму для добавления задачи. Основные элементы:
- Поля формы:
  - Название задачи (`<input type="text">`);
  - Категория (`<select>` с вариантами: "работа", "личное", "срочное");
  - Описание (`<textarea>`);
  - Тэги (`<select multiple>` с вариантами: "важно", "быстро", "сложно");
  - Шаги выполнения (`<textarea>` с разделением шагов переносом строки).
  **TODO**: Расширенный вариант (на более высокую оценку): динамическое добавление шагов с помощью JavaScript (кнопка "Добавить шаг"), где каждый шаг — отдельное поле ввода.
- Обработка ошибок валидации: ошибки отображаются под соответствующими полями.
- Навигация: ссылки на главную страницу, список задач и форму добавления.

Пример кода формы:
```php
<form method="POST" action="">
    <div>
        <label>Название задачи:</label><br>
        <input type="text" name="title" value="<?= getFormValue('title') ?>">
        <?php if (isset($errors['title'])): ?><p style="color:red"><?= $errors['title'] ?></p><?php endif; ?>
    </div>
    <!-- Другие поля -->
    <button type="submit">Отправить</button>
</form>
```

##### `src/handlers/handle_task.php`
Обработчик формы выполняет фильтрацию, валидацию и сохранение данных. Основные элементы:
- Фильтрация данных с помощью `filter_input()` для защиты от XSS.
- Валидация: проверка на пустые значения для полей "Название", "Категория" и "Описание".
- Сохранение: данные записываются в файл `storage/tasks.txt` в формате JSON с добавлением метки времени.

Пример кода обработки:
```php
$title = filter_input(INPUT_POST, 'title', FILTER_SANITIZE_FULL_SPECIAL_CHARS);
// Другие поля
if (empty($title)) {
    $errors['title'] = 'Название задачи обязательно';
}
// Валидация других полей
if (empty($errors)) {
    $task = [
        'title' => $title,
        'category' => $category,
        'description' => $description,
        'tags' => $tags,
        'steps' => $steps,
        'created_at' => date('Y-m-d H:i:s')
    ];
    file_put_contents($tasksFile, json_encode($task) . PHP_EOL, FILE_APPEND | LOCK_EX);
    header('Location: ../../index.php');
    exit;
}
```

##### `public/index.php`
Отображает две последние задачи. Основные элементы:
- Чтение данных из файла с помощью `file()`.
- Декодирование JSON-строк в массив с помощью `array_map()`.
- Вывод последних двух задач с использованием `array_slice()`.

Пример кода:
```php
$tasks = file($tasksFile, FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES);
$tasks = array_map(function($line) { return json_decode($line, true); }, $tasks);
$latestTasks = array_slice($tasks, -2);
foreach ($latestTasks as $task) {
    echo "<h2>" . htmlspecialchars($task['title']) . "</h2>";
    // Вывод других данных
}
```

##### `public/task/index.php`
Отображает все задачи. Основные элементы:
- Чтение и декодирование данных аналогично `index.php`.
- Вывод всех задач в цикле `foreach`.

Пример кода:
```php
$tasks = file($tasksFile, FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES);
$tasks = array_map(function($line) { return json_decode($line, true); }, $tasks);
foreach ($tasks as $task) {
    echo "<h2>" . htmlspecialchars($task['title']) . "</h2>";
    // Вывод других данных
}
```

##### `src/helpers.php`
Содержит вспомогательные функции:
- `getFormValue()` – возвращает значение поля формы или пустую строку.
- `isSelected()` – проверяет, выбрано ли значение в `<select>`.

Пример кода:
```php
function getFormValue($field) {
    return htmlspecialchars($_POST[$field] ?? '');
}
```

#### Ответы на контрольные вопросы
1. **Какие методы HTTP применяются для отправки данных формы?**  
   - `GET` – данные передаются в URL (подходит для простых запросов, например, поиска).  
   - `POST` – данные отправляются в теле запроса (используется для форм с конфиденциальными данными или большими объемами информации). В проекте используется `POST`.

2. **Что такое валидация данных, и чем она отличается от фильтрации?**  
   - **Валидация** – проверка данных на соответствие требованиям (например, поле не пустое, email корректен).  
   - **Фильтрация** – очистка данных от нежелательного содержимого (например, удаление тегов для защиты от XSS).  
   В проекте фильтрация выполняется через `filter_input()`, а валидация – через проверки на пустые значения.

3. **Какие функции PHP используются для фильтрации данных?**  
   - `filter_input()` – фильтрует входные данные (используется в проекте).  
   - `filter_var()` – фильтрует переменные.  
   - `htmlspecialchars()` – преобразует специальные символы в HTML-сущности (используется для вывода).

#### Список использованных источников
1. Официальная документация PHP: [https://www.php.net/manual/ru/](https://www.php.net/manual/ru/)
2. Условие лабораторной работы на GitHub.
3. Примеры кода из лекций.

#### Дополнительные важные аспекты
- Реализация пагинации осталась в плане (TODO), но базовая функциональность проекта полностью соответствует заданию.
- Код задокументирован с использованием PHPDoc для улучшения читаемости и поддержки другими разработчиками.